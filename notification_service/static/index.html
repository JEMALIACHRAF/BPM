<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications en Temps R√©el</title>
    <script>
        window.onload = function () {
            let client_id = prompt("Entrez votre ID client :", "456");

            // ‚úÖ D√©tecter si le script tourne en local ou dans Docker
            let ws_host = window.location.hostname || "localhost"; 
            let ws_url = `ws://${ws_host}:8005/ws/${client_id}`;

            console.log("üîó Connexion WebSocket √† :", ws_url);

            let ws = new WebSocket(ws_url);

            ws.onopen = function() {
                console.log("‚úÖ WebSocket connect√© !");
            };

            ws.onmessage = function(event) {
                console.log("üì© Message re√ßu:", event.data);
                
                try {
                    let message = JSON.parse(event.data);
                    console.log("üì© Message JSON re√ßu:", message);
            
                    let notificationBox = document.getElementById("notifications");
                    let newNotification = document.createElement("p");
                    newNotification.innerHTML = `<strong>${message.status}</strong>: ${message.reason}`;
                    notificationBox.appendChild(newNotification);
                } catch (error) {
                    console.error("‚ùå Erreur de parsing JSON:", error);
                }
            };

            ws.onerror = function(error) {
                console.error("‚ùå Erreur WebSocket:", error);
                alert("‚ùå Impossible de se connecter au serveur WebSocket !");
            };

            ws.onclose = function() {
                console.warn("üîå WebSocket ferm√© !");
            };
        };
    </script>
</head>
<body>
    <h2>Notifications en Temps R√©el</h2>
    <div id="notifications"></div>
</body>
</html>
